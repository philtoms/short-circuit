const t=Symbol(),n=(e,[i,...o])=>o.length?n(e[i],o):e[i]&&e[i][t];export const _CURRENT=Symbol();const e=(i,o)=>(r={},s="",c,u,f=[],b=[],l)=>{const h=function(t,n,e,s){return void 0===t||n in r&&t[n]===r[n]?r:(e?o(r=t,s):r=f.reduce((e,[i,o,s])=>s?o.call(this,e)&&e:i in r&&t[i]===r[i]?e:i===n?t:i in t?o.call(this,e,t[i]):e,r),r=i["t"]?i["t"](r,t):r,o?o(r,s):r)},R=(t,[i,R,j])=>{const[,,p,,y]=i.match(/(([\w]+):)?(\s*(.+))?/),[O,a=""]=y.split("@");if("init"===a)return r=R(r),c[u]=r,t;let d=a.startsWith("/")&&n(t,a.slice(1).split("/"));const g=!j&&a.startsWith("/");if(g)d=[],b.push([i,R,d]);else if(d)return j.forEach(t=>d.push(t)),t;const m=`${s}/${O}`,x="function"!=typeof R&&e(R,(t,n)=>h({...r,[O]:t},O,!1,n))(r[O],m,r,O,d||[],b,g);function C(t){return h.call(this,x?t:R.call(this,r,t===_CURRENT?r[O]:t),O,l,m)}return f.push([O,x?o:C,l]),t[p||O]=t=>C(t)[O],x?Object.defineProperty(t,O,{get:()=>x}):t},j=Object.entries(i).reduce(R,{[t]:f});return s?j:Object.defineProperty(b.reduce(R,j),"state",{get:()=>r})};export default e;