const t=Symbol("_REDUCERS"),e=(n={},[i,...o])=>o.length?e(n[i],o):[(n[i]||{})[t]||n[t],n[i]],n=(i,o,s)=>(r={},c=(()=>s),d={id:"",state:()=>r},f=[],u=[])=>{const a=(t,e,n,i,s)=>{if(t instanceof Promise)return t.then(t=>a(t,e,n,i)),r;if(e in t&&t[e]===r[e])return t;o&&(s&&"state"!==s?o(void 0,i,n,t):o(t,i,n));const c=r;return r=t,n||!e?r:f.reduce((t,[n,i,o])=>o?i(t[e],!0)&&r:n!==e&&t[n]!==c[n]?i(t[n]):!n&&i(void 0,o,t)||t,r)},b=(t,[i,s,b])=>{const[,,l,,v]=i.match(/(([\w]+):)?(\s*(.+))?/),[j,p=""]=v.split("$"),y="function"!=typeof s;let[O]=p.startsWith("/")&&e(t,p.slice(1).split("/"))||[];const $=!b&&p.startsWith("/");if($)y&&(O=[],u.push([i,s,O]));else if(O)return b.forEach(([t,e])=>O.push([t,e,!0])),t;const g=j,m=g?`${d.id}/${g}`:d.id||"/";g&&"object"==typeof r&&!(g in r)&&(r[g]=y?{}:void 0);const E=y&&n(s,(t,e,n,i=r)=>a(t?{...i,[g]:t}:i,g,n,e))(r[g],c,{id:m,t:g,state:()=>r},O||[],u,$),R={id:m,t:g,i:(t,n)=>e(c(),t.slice(1).split("/"))[1](n)};if("init"===p){const e=s.call(R,g?r:d.state());if(!g)return r=e,o&&o(void 0,m,!0,r),t;r[g]=e[g]}const S=function(t,e,n=(g?r:d.state())){return void 0===t&&(t=n[g]),a(E?{...n,[g]:t}:s.call(R,n,t)||r,g,e,m,!g&&p)};return g&&p&&!$||f.push([g,S,$]),Object.entries(E||{}).forEach(([t,e])=>S[t]=e),t[l||g]=S,t},l=Object.entries(i).reduce(b,{[t]:f});return s=d.id?l:Object.defineProperty(u.reduce(b,l),"state",{get:()=>r})};export default n;