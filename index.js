const t=Symbol("_REDUCERS"),e=Symbol("_BASE"),n=Symbol("_PROPAGATE"),o=(n={},[s,...i])=>"."===s?o(n,i):".."===s?o(n[e],i):s?i.length?o(n[s],i):[n[t],n[s]]:n[e]?o(n[e],[s,...i]):o(n,i),s=(i,r)=>(c={},d={t:null,id:"",state:()=>c},u=[],a=[],f={})=>{const b=(t,e,n,o,s)=>{if(t instanceof Promise)return t.then(t=>b(t,e,!1,o,s)),c;if(t===c||e in t&&t[e]===c[e])return t;const i=n!==a;return s?c=a.reduce((n,[,o,s])=>!s&&o(t[e],a,n)||n,c):(c=t,i&&(c=a.reduce((t,[n,s,i])=>i&&o.startsWith(n)?s(void 0===t[e]?t:t[e],a)&&c:!n&&s(void 0,a,t)||t,c))),r&&i&&r(c,o,!!e,n),c},l=(i,[l,y,j])=>{const[,,v,,O,S]=l.match(/(([\w]+):)?(\s*([^_]+))?(_)?/),[_,g=""]=O.split("$");if(j){const[t]=o(i,g.split("/"));return t.push([g.replace(/\./g,""),y,!0]),i}const m=/^[\/\.]/.test(g),E="function"!=typeof y,P=E&&Object.keys(y).some(t=>!t.startsWith("$")),$=_,p=($||g?`${d.id}/${$||g}`:d.id||"/").replace("//","/");$&&"object"==typeof c&&!($ in c)&&(c[$]=E?{}:void 0);const A=E?s(y,(t,e,n,o)=>c=b(n?{...c,[$]:t}:t,$,o,e))(c[$]||c,{t:i,id:p,o:$,state:()=>c},u):{},R={id:p,o:$,s:(t,e)=>o(i,t.split("/"))[1](e)},w=new Proxy(R,{get:(t,e)=>e in f?f[e]:R[e],set:(t,e,n)=>(f[e]=n,!0)});if("init"===g){const t=y.call(w,$?c:d.state());if(!$)return void 0!==t&&(c=t,r&&r(c,p)),i;t&&(c[$]=t[$])}const x=function(t,e,o=($?c:d.state())){const s=$||d.o;return void 0===t&&(t=o[s]),(E?A[n]:b)(E?{...o,[s]:t}:S?{...o,[s]:y.call(w,t)||o[s]}:y.call(w,o,t)||o,E&&!P?"":$,e,p,P)};return(m||g)&&"state"!==g||a.push([$,x]),m&&u.push([l,x,!0]),Object.entries(A).forEach(([t,e])=>x[t]=e),x[t]=A[t],x[e]=A[e],i[v||$||g]=x,i},y=Object.entries(i).reduce(l,{[t]:a,[e]:d.t,[n]:b});return d.id?y:Object.defineProperty(u.reduce(l,y),"state",{get:()=>c})};export default s;