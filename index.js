const t=Symbol("_REDUCERS"),n=Symbol("_BASE"),e=Symbol("_PROPAGATE"),o=(e={},[i,...s])=>"."===i?o(e,s):".."===i?o(e[n],s):i?s.length?o(e[i],s):[e[t],e[i]]:e[n]?o(e[n],[i,...s]):o(e,s),i=(s,r,c,d={})=>(f={},u={id:"",state:()=>f},a=[],b=[])=>{const y=(t,n,e,o,i)=>{if(t instanceof Promise)return t.then(t=>y(t,n,!1,o,i)),f;if(t===f||n in t&&t[n]===f[n])return t;const s=e!==b;return i?f=b.reduce((e,[,o,i])=>!i&&o(t[n],b,e)||e,f):(f=t,s&&(f=b.reduce((t,[e,i,s])=>s&&o.startsWith(e)?i(void 0===t[n]?t:t[n],b)&&f:!e&&i(void 0,b,t)||t,f))),r&&s&&r(f,o,!!n,e),f},j=(s,[c,j,l])=>{const[,,v,,O]=c.match(/(([\w]+):)?(\s*(.+))?/),[S,g=""]=O.split("$");if(l){const[t]=o(s,g.split("/"));return t.push([g.replace(/\./g,""),j,!0]),s}const m=g.startsWith("/")||g.startsWith("."),E="function"!=typeof j,P=E&&Object.keys(j).some(t=>!t.startsWith("$")),$=S,p=($||g?`${u.id}/${$||g}`:u.id||"/").replace("//","/");$&&"object"==typeof f&&!($ in f)&&(f[$]=E?{}:void 0);const A=E?i(j,(t,n,e,o)=>f=y(e?{...f,[$]:t}:t,$,o,n),s)(f[$]||f,{id:p,t:$,state:()=>f},a):{},R={id:p,t:$,o:(t,n)=>o(s,t.split("/"))[1](n)},_=new Proxy(R,{get:(t,n)=>n in d?d[n]:R[n],set:(t,n,e)=>(d[n]=e,!0)});if("init"===g){const t=j.call(_,$?f:u.state());if(!$)return void 0!==t&&(f=t,r&&r(f,p)),s;t&&(f[$]=t[$])}const w=function(t,n,o=($?f:u.state())){const i=$||u.t;return void 0===t&&(t=o[i]),(E?A[e]:y)(E?{...o,[i]:t}:j.call(_,o,t)||o,E&&!P?"":$,n,p,P)};return(m||g)&&"state"!==g||b.push([$,w]),m&&a.push([c,w,!0]),Object.entries(A).forEach(([t,n])=>w[t]=n),w[t]=A[t],w[n]=A[n],s[v||$||g]=w,s},l=Object.entries(s).reduce(j,{[t]:b,[n]:c,[e]:y});return u.id?l:Object.defineProperty(a.reduce(j,l),"state",{get:()=>f})};export default i;