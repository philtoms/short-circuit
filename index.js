const t=Symbol(),e=(n,[o,...s])=>s.length?e(n[o],s):n[o]&&n[o][t];export const _CURRENT=Symbol();const n=(o,s)=>(c={},i={id:""},r=[],f=[],u)=>{const b=(t,e,n,i)=>void 0===t||e in t&&t[e]===c[e]?c:(c=n?t:r.reduce((n,[o,s,i])=>i?s(n)&&n:o in t?t[o]===c[o]?n:o===e?{...n,[o]:t[e]}:t=s(t[o],!0,t):t,c),c=o["t"]?o["t"](c,t[e]):c,s?s(c,i):c),d=(t,[o,d,l])=>{const[,,a,,j]=o.match(/(([\w]+):)?(\s*(.+))?/),[p,y=""]=j.split("@");if("init"===y)return c=d(c),i.state&&(i.state[i.o]=c),t;let R=y.startsWith("/")&&e(t,y.slice(1).split("/"));const g=!l&&y.startsWith("/");if(g)R=[],f.push([o,d,R]);else if(R)return l.forEach(t=>R.push(t)),t;const O=`${i.id}/${p}`,m="function"!=typeof d&&n(d,(t,e)=>b(e.endsWith("/")?t:{...c,[p]:t},p,!1,e))("object"==typeof c[p]?c[p]:c,{id:O,state:c,o:p},R||[],f,g),x=function(t,e,n=c){t===_CURRENT&&(t=c[p]);const o=p||i.o;return b(m?t:d.call({s:o},n,t),p||i.o,u||e,O)};return r.push([p||i.o,m?s:x,u]),t[a||p]=t=>x(t)[p],m?Object.defineProperty(t,p,{get:()=>m}):t},l=Object.entries(o).reduce(d,{[t]:r});return i.id?l:Object.defineProperty(f.reduce(d,l),"state",{get:()=>c})};export default n;