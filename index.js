const t=Symbol("_REDUCERS"),n=Symbol("_BASE"),e=Symbol("_PROPAGATE"),o=(e={},[s,...i])=>"."===s?o(e,i):".."===s?o(e[n],i):s?i.length?o(e[s],i):[e[t],e[s]]:e[n]?o(e[n],[s,...i]):o(e,i),s=(i,r,c,d={})=>(f={},u={id:"",state:()=>f},a=[],b=[])=>{const y=(t,n,e,o,s)=>{if(t instanceof Promise)return t.then(t=>y(t,n,!1,o,s)),f;if(t===f||n in t&&t[n]===f[n])return t;const i=e===b,c=f;return s?f=b.reduce((e,[,o,s])=>!s&&o(t[n],b,e)||e,f):(f=t,i||(f=b.reduce((t,[e,s,i])=>i&&o.startsWith(e)?s(t[n]||t,b)&&f:e!==n&&t[e]!==c[e]?s(t[e],b):!e&&s(void 0,b,t)||t,f))),r&&!i&&r(f,o,!!n,e),f},j=(i,[c,j,l])=>{const[,,O,,S]=c.match(/(([\w]+):)?(\s*(.+))?/),[g,m=""]=S.split("$");if(l){const[t]=o(i,m.split("/"));return t.push([m.replace(/\./g,""),j,!0]),i}const v=m.startsWith("/")||m.startsWith("."),E="function"!=typeof j,P=E&&Object.keys(j).some(t=>!t.startsWith("$")),$=g,p=$||m?`${u.id}/${$||m}`:u.id||"/";$&&"object"==typeof f&&!($ in f)&&(f[$]=E?{}:void 0);const A=E?s(j,(t,n,e,o)=>f=y(e?{...f,[$]:t}:t,$,o,n),i)(f[$]||f,{id:p,t:$,state:()=>f},a):{},R={id:p,t:$,o:(t,n)=>o(i,t.split("/"))[1](n)},_=new Proxy(R,{get:(t,n)=>n in d?d[n]:R[n],set:(t,n,e)=>d[n]=e});if("init"===m){const t=j.call(_,$?f:u.state());if(!$)return void 0!==t&&(f=t,r&&r(f,p)),i;t&&(f[$]=t[$])}const w=function(t,n,o=($?f:u.state())){const s=$||u.t;return void 0===t&&(t=o[s]),(E?A[e]:y)(E?{...o,[s]:t}:j.call(_,o,t)||o,E&&!P?"":$,n,p,P)};return(v||m)&&"state"!==m||b.push([$,w]),v&&a.push([c,w,!0]),Object.entries(A).forEach(([t,n])=>w[t]=n),w[t]=A[t],w[n]=A[n],i[O||$||m]=w,i},l=Object.entries(i).reduce(j,{[t]:b,[n]:c,[e]:y});return u.id?l:Object.defineProperty(a.reduce(j,l),"state",{get:()=>f})};export default s;