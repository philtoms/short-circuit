const t=Symbol(),e=(n,[o,...s])=>s.length?e(n[o],s):n[o]&&n[o][t];export const _CURRENT=Symbol();const n=(o,s)=>(r={},c={id:""},i=[],f=[],u)=>{const a=(t,e,n,c)=>{if(!t||e in t&&t[e]===r[e])return r;const f=n?t:i.reduce((n,[o,s,c])=>((n=c?s(n)&&r:o in t?t[o]===n[o]?n:o===e?{...n,[o]:t[e]}:s(t[o]):t)instanceof Promise||(r=n),n),r);return f instanceof Promise?(f.then(t=>a(t,e,!1,c)),r):(r=o["t"]?o["t"](f,t[e]):f,s&&s(r,c)||r)},b=(t,[o,b,l])=>{const[,,d,,j]=o.match(/(([\w]+):)?(\s*(.+))?/),[m,p=""]=j.split("@");if("init"===p)return r=b(r),c.state&&(c.state[c.o]=r),t;let y=p.startsWith("/")&&e(t,p.slice(1).split("/"));const R=!l&&p.startsWith("/");if(R)y=[],f.push([o,b,y]);else if(y)return l.forEach(t=>y.push(t)),t;const g=`${c.id}/${m}`,O="function"!=typeof b&&n(b,(t,e)=>a(e.endsWith("/")?t:{...r,[m]:t},m,!1,e))("object"==typeof r[m]?r[m]:r,{id:g,state:r,o:m},y||[],f,R),x=function(t){t===_CURRENT&&(t=r[m]);const e=m||c.o;return a(O?t:b.call({s:e},r,t),m||c.o,u,g)};return i.push([m||c.o,O?s:x,u]),t[d||m]=t=>x(t)[m],O?Object.defineProperty(t,m,{get:()=>O}):t},l=Object.entries(o).reduce(b,{[t]:i});return c.id?l:Object.defineProperty(f.reduce(b,l),"state",{get:()=>r})};export default n;